<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>NORA - Nordakademie Organizer & Room Assistant</title>
    <script src="js/dark-mode.js"></script>
    <style>
        /* Prevent white flash in dark mode during app initialization */
        @media (prefers-color-scheme: dark) {
            html, body {
                background-color: #0f172a;
            }
        }

        /* Also support manual dark mode class (set by dark-mode.js) */
        html.dark, html.dark body {
            background-color: #0f172a;
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3cd2ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-center;
            min-height: 100vh;
            color: #6b7280;
        }
    </style>

    <!-- Keycloak JS -->
    <script src="https://auth.nora-nak.de/js/keycloak.js"></script>
</head>
<body>
    <div class="loading-container">
        <div class="spinner"></div>
        <p>Authentifizierung wird überprüft...</p>
    </div>

    <!-- Scripts -->
    <script src="js/keycloak-auth.js"></script>
    <script>
        (async function() {
            console.log('[Index] Initializing Keycloak authentication check');

            try {
                // Initialize Keycloak
                const authenticated = await KeycloakAuth.init();

                if (authenticated) {
                    // User is authenticated, redirect to dashboard
                    console.log('[Index] User authenticated, redirecting to dashboard');
                    window.location.replace('dashboard.html');
                } else {
                    // User is not authenticated, redirect to login
                    console.log('[Index] User not authenticated, redirecting to login');
                    window.location.replace('login.html');
                }
            } catch (error) {
                // Error during initialization, redirect to login
                console.error('[Index] Keycloak initialization failed:', error);
                window.location.replace('login.html');
            }
        })();
    </script>
</body>
</html>
